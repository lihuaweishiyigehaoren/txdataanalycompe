## <center>初赛第一题：MOBA代练行为检测</center>

### 1、输入

大赛方提供的输入数据主要包括两类：

1. 对局战绩流水

   玩家账号，大区ID，游戏模式，对局开始时间，英雄ID，队伍ID，击杀数量，被击杀数量，助攻数量，最大连杀，对局评价分，标识位，扩展标识位，英雄数量度

2. 对局行为流水

   玩家账号，大区号，对局id，游戏结束时间，游戏开始时间，地图ID，游戏对局时长，游戏模式，游戏子模式，经验变化值，总的经验值，历史获得总金币数，金币变化数，玩家ELO分，leaver flag逃跑者标志，造成的伤害，受到的伤害，获得的金币，治疗，最大连杀，最大多杀，造成的魔法伤害，承受的魔法伤害，击杀的小兵，击杀的中立生物，造成的物理伤害，受到的物理伤害，死亡的时间，摧毁的防御塔，召唤师技能1，召唤师技能2，召唤师等级，本局游戏召唤师的英雄ID，量化玩家队伍取得胜利机会的因素，表明该玩家所在队伍是否属于组队的布尔值，组队的玩家个数，游戏结束后ELO值得变化

#### 特征提取

针对该赛题，我选择特征提取的思路主要由两种：

1. 凭借主观经验提取特征
2. 借助机器学习手段提取特征

**（1）、凭借主观经验提取特征**

对于MOBA类游戏有所熟悉的玩家都很清楚，一旦队友或者对手出现以下几类情况的时候很可能就是代练：

- 选择核心位置（打野，中单），通常使用同一个英雄的频率较高，英雄熟练度较低（因为跟玩家的英雄池很可能不重叠）
- 为了提高效率，通常是三人或五人组队，且能快速终结比赛，游戏时长较短
- 战场上其刷钱速度较快
- carry全场，KDA普遍较高
- ……

基于以上特征，我们对原始数据进行针对性的分析：

从原始数据中随机抽取10名玩家（6名代练和4名正常玩家）

（一）是否经常使用同一英雄

衡量指标：
$$
最大英雄使用频率=\frac {使用最多英雄的次数} {总局数}
$$

结果（其中左边四个是正常玩家，右边6个是代练）：

![herocountradio](.\picture\herocountradio.png)

结论：该特征不明显

（二）是否具有较高的游戏评分

衡量标准：
$$
评分平均度= \frac {评分总和} {总局数}
$$
结果（其中左边四个是正常玩家，右边6个是代练）

![averscore](.\picture\averscore.png)

结论：该特征也不明显



我经过反复测试其他认为明显的特征，发现这些指标对该问题都不明显。

**结论**：该方法对所要解决的问题效果并不明显，这不是某一或者某几个指标决定的，而是所有的指标的一个综合结果。



**（2）、利用现有的机器学习方法**

在解决实际问题过程中，我们更倾向于先找到适合的简单的算法，看似复杂的问题，如果能够用简单的方法解决，我们为什么要使用复杂的方法呢。

针对该问题，通过以上分析我们知道，它不是受某几个因素的影响，跟任何指标不存在严格的关系，因而我们应该综合考虑所有的因素，利用机器学习方法提取出特征。

在这里我选择了**PCA**（主成分分析）降维提取特征，其中剔除了一些在各个数据里面从来没有变化过的输入（比如队伍ID等等），过程如下：

（一）根据训练数据（训练集玩家名单.txt）文件的大区和id作为索引，采用**快排**和**二分查找**（这里是为了提高搜索效率，不然会非常慢）分别找出文件（LOL对局战绩流水_20190226-20190307.txt）和文件（LOL对局行为流水_20190226-20190307.txt）对应的玩家数据。

（二）将对应的相同大区和玩家的指标（会有多个对局的指标，已经剔除过无关的），将玩家这些对局的指标求平均（代表这一段时间的平均水平，避免受到某一单次的影响）。LOL对局战绩流水和LOL对局行为流水指标合并，最后得到一个代表该玩家这段事件综合水平的一个多维度指标特征向量。

（三）采用PCA对处理后的训练集做降维处理，得到一张代表所有玩家的一张表。如下图所示：

![averscore](.\picture\pcatrain.png)



**至此，我们的专家样本构建完毕，我们以PCA降维得到的前三个主成分（基本代表）作为我们训练模型的输入特征**



### 2、模型训练

经过多次的尝试，我使用了LM神经网络和CART决策树两种方法，进行了训练，最终CART决策树较优，其中LM神经网络遇到了一些问题，后期有时间再解决。

因此，最终我选定的模型是：**PCA(预处理，其他的通用处理方法省略写) + CART决策树模型**

经过得到的训练模型CART决策树（tree.kpl) 对训练数据，其中80%做训练，20%做测试，得到的混洗矩阵如下：

![averscore](.\picture\cartfinalresult.png)

通过计算，准确率为：
$$
准确率=\frac {87632+9711} {87632+9711+1+3} =0.9999589
$$
可以看到，准确率达到了**99.99589%**，我也没有想到会这么高。

